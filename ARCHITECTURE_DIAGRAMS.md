# ğŸ¯ Navigation Refactor - Visual Architecture

## Application Structure Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    STREAMLIT APPLICATION                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚                    PAGE CONFIG                           â”‚   â”‚
â”‚ â”‚  - Title: Code Nest Sales Engine Pro                     â”‚   â”‚
â”‚ â”‚  - Layout: Wide                                          â”‚   â”‚
â”‚ â”‚  - Sidebar: Expanded                                     â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                    â”‚
â”‚                            â†“                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚              AUTHENTICATION LAYER                        â”‚   â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚ â”‚  â”‚ Not Authenticated?                                 â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ â†’ show_auth_page() [Login/Signup]                  â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ â†’ st.stop() [Block rest of app]                    â”‚ â”‚   â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚ â”‚  Authenticated: Continue to main app                  â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                    â”‚
â”‚                            â†“                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚               SIDEBAR NAVIGATION                        â”‚   â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚ â”‚  â”‚ ğŸ¦… Code Nest Panel                                â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ Navigation                                         â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ [Single Audit]  â† All users see                   â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ [Bulk Audit]    â† Admins only                     â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ [API Settings]  â† Admins only                     â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ [Admin Settngs] â† Admins only                     â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                 â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ ğŸŸ¢ System: Active                                 â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ User: [username]                                  â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ Role: [admin/user]                                â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ [Logout Button]                                   â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ [2FA Setup - admins]                              â”‚ â”‚   â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                    â”‚
â”‚                            â†“                                    â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚           MAIN CONTENT AREA - ROUTING                   â”‚   â”‚
â”‚ â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚ â”‚  â”‚ st.session_state.current_section = ?               â”‚ â”‚   â”‚
â”‚ â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ if current_section == "Single Audit":             â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ â†’ show_single_audit()                             â”‚ â”‚   â”‚
â”‚ â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ elif current_section == "Bulk Audit":             â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ â†’ check if admin â†’ show_bulk_audit()              â”‚ â”‚   â”‚
â”‚ â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ elif current_section == "API Settings":           â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ â†’ check if admin â†’ show_api_settings()            â”‚ â”‚   â”‚
â”‚ â”‚  â”‚                                                    â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ elif current_section == "Admin Settings":         â”‚ â”‚   â”‚
â”‚ â”‚  â”‚ â†’ check if admin â†’ show_admin_settings()          â”‚ â”‚   â”‚
â”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                            â”‚                                    â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚          â†“                 â†“                 â†“                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚    â”‚ Single Audit â”‚ â”‚ Bulk Audit   â”‚ â”‚ API Settings â”‚         â”‚
â”‚    â”‚              â”‚ â”‚              â”‚ â”‚              â”‚         â”‚
â”‚    â”‚ â€¢ URL input  â”‚ â”‚ â€¢ CSV upload â”‚ â”‚ â€¢ OpenAI key â”‚         â”‚
â”‚    â”‚ â€¢ Analyze    â”‚ â”‚ â€¢ Process    â”‚ â”‚ â€¢ Google key â”‚         â”‚
â”‚    â”‚ â€¢ Results    â”‚ â”‚ â€¢ Download   â”‚ â”‚ â€¢ Slack hook â”‚         â”‚
â”‚    â”‚ â€¢ Download   â”‚ â”‚              â”‚ â”‚              â”‚         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚          â†“                 â†“                 â†“                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚    â”‚ Admin        â”‚ â”‚              â”‚ â”‚              â”‚         â”‚
â”‚    â”‚ Settings     â”‚ â”‚              â”‚ â”‚              â”‚         â”‚
â”‚    â”‚              â”‚ â”‚              â”‚ â”‚              â”‚         â”‚
â”‚    â”‚ â€¢ Users mgmt â”‚ â”‚              â”‚ â”‚              â”‚         â”‚
â”‚    â”‚ â€¢ Analytics  â”‚ â”‚              â”‚ â”‚              â”‚         â”‚
â”‚    â”‚ â€¢ Config     â”‚ â”‚              â”‚ â”‚              â”‚         â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Session State Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      SESSION STATE INITIALIZATION       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
     Check if logged in?
     â”œâ”€ No â†’ show_auth_page() â†’ st.stop()
     â””â”€ Yes â†’ continue
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    INITIALIZE NAVIGATION STATE          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ current_section = 'Single Audit'        â”‚
â”‚ OPENAI_API_KEY = env var (if exists)    â”‚
â”‚ GOOGLE_API_KEY = None                   â”‚
â”‚ SLACK_WEBHOOK = None                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      RENDER SIDEBAR NAVIGATION          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ nav_items = ["Single Audit"]            â”‚
â”‚ if is_admin:                            â”‚
â”‚   nav_items += [                        â”‚
â”‚     "Bulk Audit",                       â”‚
â”‚     "API Settings",                     â”‚
â”‚     "Admin Settings"                    â”‚
â”‚   ]                                     â”‚
â”‚                                         â”‚
â”‚ For each item in nav_items:             â”‚
â”‚   Create button                         â”‚
â”‚   If clicked:                           â”‚
â”‚     current_section = item              â”‚
â”‚     st.rerun()                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      RENDER MAIN CONTENT AREA           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ if current_section == section:          â”‚
â”‚   show_section()                        â”‚
â”‚                                         â”‚
â”‚ Section gets API keys from session:     â”‚
â”‚   run_audit(                            â”‚
â”‚     url,                                â”‚
â”‚     st.session_state.OPENAI_API_KEY,    â”‚
â”‚     st.session_state.GOOGLE_API_KEY     â”‚
â”‚   )                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Navigation Button State Machine

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      NAVIGATION BUTTON STATE        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ If current_section == "Single Audit"
           â”‚  â””â”€ Button type = "primary" (blue)
           â”‚
           â”œâ”€ Else if current_section == "Bulk Audit"
           â”‚  â””â”€ Button type = "primary" (blue)
           â”‚
           â”œâ”€ Else if current_section == "API Settings"
           â”‚  â””â”€ Button type = "primary" (blue)
           â”‚
           â””â”€ Else
              â””â”€ Button type = "secondary" (gray)


USER CLICKS BUTTON
       â”‚
       â†“
  if st.button("Bulk Audit"):
    st.session_state.current_section = "Bulk Audit"
    st.rerun()
       â”‚
       â”œâ”€ Page refreshes
       â”œâ”€ current_section now = "Bulk Audit"
       â”œâ”€ "Bulk Audit" button renders in blue
       â”œâ”€ show_bulk_audit() is called
       â”œâ”€ Main area renders Bulk Audit content
       â””â”€ Other buttons render in gray
```

---

## API Key Session Storage

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    USER ENTERS API KEY IN UI             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Input field: [password type]             â”‚
â”‚ On input change:                         â”‚
â”‚   st.session_state.OPENAI_API_KEY = val  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    KEY STORED IN SESSION STATE           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ session_state = {                        â”‚
â”‚   'OPENAI_API_KEY': 'sk-...',            â”‚
â”‚   'GOOGLE_API_KEY': 'AIza...',           â”‚
â”‚   'SLACK_WEBHOOK': 'https://...',        â”‚
â”‚   'current_section': 'API Settings',     â”‚
â”‚   'authenticated': True,                 â”‚
â”‚   'current_user': 'admin',               â”‚
â”‚   'is_admin': True,                      â”‚
â”‚   ...                                    â”‚
â”‚ }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    KEY USED IN FUNCTION CALLS            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ if st.session_state.current_section ==   â”‚
â”‚    "Single Audit":                       â”‚
â”‚   data = run_audit(                      â”‚
â”‚     url,                                 â”‚
â”‚     st.session_state.OPENAI_API_KEY,     â”‚ â† from session
â”‚     st.session_state.GOOGLE_API_KEY      â”‚ â† from session
â”‚   )                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    KEY LIFECYCLE ENDS                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Page refresh          â†’ Key cleared    â”‚
â”‚ â€¢ User logout           â†’ Key cleared    â”‚
â”‚ â€¢ Browser session close â†’ Key cleared    â”‚
â”‚ â€¢ User closes tab       â†’ Key cleared    â”‚
â”‚                                          â”‚
â”‚ Key is NEVER:                            â”‚
â”‚ â€¢ Saved to JSON file                     â”‚
â”‚ â€¢ Saved to database                      â”‚
â”‚ â€¢ Sent over network (except to APIs)     â”‚
â”‚ â€¢ Logged to console                      â”‚
â”‚ â€¢ Cached in browser                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Role-Based Access Control

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    USER LOGS IN                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Check role in users.json:                â”‚
â”‚ "role": "admin" OR "role": "user"        â”‚
â”‚                                          â”‚
â”‚ Store in session:                        â”‚
â”‚ st.session_state.is_admin = True/False   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ If is_admin == False (Regular User)
           â”‚  â”‚
           â”‚  â†“
           â”‚  nav_items = ["Single Audit"]
           â”‚  â”‚
           â”‚  â””â”€â†’ Limited navigation
           â”‚
           â””â”€ If is_admin == True (Admin User)
              â”‚
              â†“
              nav_items = [
                "Single Audit",
                "Bulk Audit",
                "API Settings",
                "Admin Settings"
              ]
              â”‚
              â””â”€â†’ Full navigation

WHEN USER TRIES TO ACCESS RESTRICTED SECTION
       â”‚
       â†“
if current_section == "Bulk Audit":
  if not st.session_state.get("is_admin"):
    st.error("This section is admin-only")
  else:
    show_bulk_audit()
```

---

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER INTERACTION IN UI              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ Click navigation button
           â”œâ”€ Enter text in form
           â”œâ”€ Upload file
           â””â”€ Click action button
                    â”‚
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SESSION STATE UPDATED               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ st.session_state.current_section changed
           â”œâ”€ st.session_state.OPENAI_API_KEY updated
           â”œâ”€ Form fields stored
           â””â”€ File data captured
                    â”‚
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STREAMLIT RERUNS PAGE               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ Re-execute main app code
           â”œâ”€ Check current_section
           â”œâ”€ Call appropriate show_*() function
           â””â”€ Render updated UI
                    â”‚
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FUNCTIONS PROCESS DATA              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ run_audit(url, keys) â†’ audit data
           â”œâ”€ generate_pdf(data) â†’ PDF bytes
           â”œâ”€ save_audit_to_db(data) â†’ audit_id
           â””â”€ save_audit_pdf_to_file(id, bytes)
                    â”‚
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RESULTS RENDERED TO USER            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€ Metrics displayed
           â”œâ”€ Tables shown
           â”œâ”€ Download buttons provided
           â””â”€ Next action indicated
```

---

## File Structure

```
/workspaces/sales-engine/
â”‚
â”œâ”€â”€ app.py (REFACTORED)
â”‚  â”œâ”€ Authentication layer
â”‚  â”œâ”€ Sidebar navigation
â”‚  â”œâ”€ Session state management
â”‚  â”œâ”€ show_api_settings()
â”‚  â”œâ”€ show_single_audit()
â”‚  â”œâ”€ show_bulk_audit()
â”‚  â”œâ”€ show_audit_history()
â”‚  â”œâ”€ Helper functions (unchanged)
â”‚  â”œâ”€ Database functions (unchanged)
â”‚  â”œâ”€ Audit logic (unchanged)
â”‚  â””â”€ PDF generation (unchanged)
â”‚
â”œâ”€â”€ models.py (UNCHANGED)
â”‚  â”œâ”€ Database models
â”‚  â”œâ”€ User model
â”‚  â”œâ”€ Audit model
â”‚  â”œâ”€ Lead model
â”‚  â””â”€ EmailOutreach model
â”‚
â”œâ”€â”€ users.json
â”‚  â””â”€ File-based user store
â”‚
â”œâ”€â”€ audit_pdfs/
â”‚  â””â”€ Persistent PDF storage
â”‚
â”œâ”€â”€ requirements.txt
â”‚  â””â”€ Python dependencies
â”‚
â”œâ”€â”€ NAVIGATION_REFACTOR.md
â”‚  â””â”€ Technical reference
â”‚
â”œâ”€â”€ REFACTOR_SUMMARY.md
â”‚  â””â”€ Quick reference guide
â”‚
â””â”€â”€ IMPLEMENTATION_COMPLETE_REFACTOR.md
   â””â”€ High-level overview
```

---

## Key Interactions

### Scenario 1: User Switches Section

```
User clicks "Bulk Audit"
    â†“
if st.button("Bulk Audit", ...):
    st.session_state.current_section = "Bulk Audit"
    st.rerun()
    â†“
Page reloads with new state
    â†“
main application checks current_section
    â†“
elif current_section == "Bulk Audit":
    show_bulk_audit()
    â†“
Bulk audit page renders
```

### Scenario 2: User Enters API Key

```
User inputs in "API Settings"
    â†“
st.session_state.OPENAI_API_KEY = value
    â†“
Status changes to "âœ“ API Key configured"
    â†“
User runs audit in "Single Audit"
    â†“
run_audit(..., st.session_state.OPENAI_API_KEY, ...)
    â†“
AI analysis generated
    â†“
Results shown with email draft
```

### Scenario 3: Regular User Tries Admin Feature

```
User clicks "Bulk Audit"
    â†“
Button clicks but "Bulk Audit" is NOT in nav_items
    â†“
Actually, button doesn't exist for regular users
    â†“
They can only see "Single Audit"
    â†“
(If somehow accessed via session hack)
    â†“
elif current_section == "Bulk Audit":
    if not st.session_state.get("is_admin"):
        st.error("Admin only")
    â†“
Error displayed
```

---

## This Is Your New Architecture

Your app now uses a **clean, modular navigation system** with:
- âœ… Single-page app with dynamic content
- âœ… Session-based state management
- âœ… Role-based access control
- âœ… Secure API key handling
- âœ… Professional sidebar navigation
- âœ… Clear visual hierarchy

**Status: Complete, Tested, and Deployed** ğŸ‰
